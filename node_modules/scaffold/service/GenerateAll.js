"use strict";

exports.generateAll = function () {
    var fs = require("fs");
    var _ = require("underscore");
    var serviceContent = require("./Content");
    fs.readdir(process.cwd() + "/schema/", function (error, schemas) {
        if (error) {
            console.log("Some error occur while reading the schemas, Error: ", error);
        } else if (schemas && schemas.length > 0) {
            schemas.forEach(function (schemaName) {
                var domainName = schemaName.replace(/^(.)(.*)(.json)$/, function (schemaName, g1, g2) {
                    return g1.toUpperCase() + g2;
                });
                var newDocumentData = "{";
                var schema = require(process.cwd() + "/schema/" + schemaName);
                _.each(schema, function (value, key) {
                    newDocumentData += ("\n        " + key + ": " + domainName.toLowerCase() + "CO." + key + ",");
                });
                newDocumentData += "}";
                newDocumentData = newDocumentData.replace(/,}/, "\n    }");
                var service = serviceContent.getText().replace(/{{domainName}}/g, domainName)
                    .replace(/{{domainNameInSmallLetter}}/g, domainName.toLowerCase())
                    .replace(/{{newDocument}}/, newDocumentData);
                fs.writeFile(process.cwd() + "/service/" + domainName + "Service.js", service, function (error, data) {
                    console.log(error, data)
                });
            });
        } else {
            console.log("No Schema found");
        }
    });
};