"use strict";

exports.generateAll = function () {
    var fs = require("fs");
    var _ = require("underscore");
    var ngRouteContent = require("./Content");
    var CONSTANTS = require("../enum/CONSTANTS");
    fs.readdir(process.cwd() + "/schema/", function (error, schemas) {
        if (error) {
            console.log("Some error occur while reading the schemas, Error: ", error);
        } else if (schemas && schemas.length > 0) {
            var ngRouteDirectory = process.cwd() + "/public/js/";
            var generateNgControllers = function (ngControllerDirectory, domainName) {
                var domainNameInSmallLetter = domainName.toLowerCase();
                var controller = ngRouteContent.getText().replace(/{{domainName}}/g, domainName).
                    replace(/{{domainNameInSmallLetter}}/g, domainNameInSmallLetter);
                fs.writeFile(ngControllerDirectory + "route.js", controller, function (error, data) {
                    console.log(error, data)
                });
            };
            var generateNgControllersAndDirectory = function () {
                schemas.forEach(function (schemaName) {
                    var domainName = schemaName.replace(/^(.)(.*)(.json)$/, function (schemaName, g1, g2) {
                        return g1.toUpperCase() + g2;
                    });
                    var ngControllerDirectory = ngRouteDirectory + domainName.toLowerCase() + "/";
                    fs.exists(ngControllerDirectory, function (exists) {
                        if (exists) {
                            generateNgControllers(ngControllerDirectory, domainName);
                        } else {
                            fs.mkdir(ngControllerDirectory, function (error, dir) {
                                if (error) {
                                    console.log("Error Occur at the time of creating the directive(" + ngControllerDirectory + "). Error= ", error);
                                } else {
                                    generateNgControllers(ngControllerDirectory, domainName);
                                }
                            });
                        }
                    });
                });
            };
            fs.exists(ngRouteDirectory, function (exists) {
                if (exists) {
                    generateNgControllersAndDirectory()
                } else {
                    fs.mkdir(ngRouteDirectory, function (error, dir) {
                        if (error) {
                            console.log("Error Occur at the time of creating the directive(" + ngRouteDirectory + "). Error= ", error);
                        } else {
                            generateNgControllersAndDirectory();
                        }
                    });
                }
            });
        } else {
            console.log("No Schema found");
        }
    });
};