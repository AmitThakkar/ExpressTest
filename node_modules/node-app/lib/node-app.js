"use strict";

function NodeServer() {
    var _ = require('underscore');
    var express = require('express');
    var application = express();
    application.use(function (request, response, next) {
        console.log("Request -> ", request.url);
        next();
    });
    application.use(express.bodyParser());
    application.use(express.static(process.cwd() + '/public'));
    application.use(express.static(process.cwd() + '/views'));
    var appConfig = require(process.cwd() + '/config/AppConfig');
    var IOC = require('./IOC');
    var Bootstrap = require(process.cwd() + '/config/Bootstrap');
    application.config = _.extend(appConfig.common, appConfig[process.env["env"] || 'development']);
    this.start = function () {
        var portNumber;
        try {
            portNumber = process.env["PORT"];
        } catch (e) {
            console.log("PORT environment variable not found!");
        }
        if (!portNumber) {
            portNumber = application.config.port;
        }
        application.listen(portNumber);
        console.log("---> Server Url: ", application.config.serverUrl);
    };
    IOC.initializeApplication.call(application);
    Bootstrap.init.call(application);
}

exports.createNodeServer = function () {
    return new NodeServer()
};